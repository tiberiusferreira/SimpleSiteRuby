<h2>Home Page</h2>

<p>This would be a static home page in a Rails application.</p>
<head>
  <style>
     #map {
      height: 400px;
      width: 50%;
     }
  </style>
</head>
<body>
  <h3>Shops</h3>
  <p>Click the button to get your coordinates.</p>

  <button onclick="getLocation()">Try It</button>
  <button onclick="showLat()">Show lat</button>


  <p id="demo"></p>
  <p id="demo2"></p>

  <div id="map"></div>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDOAcTqov7sfiYl5EiNeR5sLBE33aPXmo4&signed_in=true"></script>
  <script>
var latitude;
var longitude;
var x = document.getElementById("demo");
var y = document.getElementById("demo2");




navigator.geolocation.getCurrentPosition(initialize);
  // In the following example, markers appear when the user clicks on the map.
  // Each marker is labeled with a single alphabetical character.
  function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) {
    var R = 6371; // Radius of the earth in km
    var dLat = deg2rad(lat2-lat1);  // deg2rad below
    var dLon = deg2rad(lon2-lon1);
    var a =
      Math.sin(dLat/2) * Math.sin(dLat/2) +
      Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
      Math.sin(dLon/2) * Math.sin(dLon/2)
      ;
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    var d = R * c; // Distance in km
    return d;
  }

  function deg2rad(deg) {
    return deg * (Math.PI/180)
  }
  function initialize(position) {
    latitude = position.coords.latitude;
    longitude = position.coords.longitude;

    var distance = 10;

    // wait for current person position
    y.innerHTML += "Lat = " + latitude

    var home = { lat: latitude, lng: longitude };
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 12,
      center: home
    });

    // This event listener calls addMarker() when the map is clicked.
    google.maps.event.addListener(map, 'click', function(event) {
      // addMarker(event.latLng, map);
    });

    // Add a marker at the center of the map.

    <% @shops.each do |shop| %>
      var shoplat = <%= shop.latitude %>
      var shoplong = <%= shop.longitude %>
      dist = getDistanceFromLatLonInKm(shoplat, shoplong, latitude, longitude)
      if( dist < distance ){

        addMarker({lat: <%= shop.latitude %>, lng:<%= shop.longitude %>}, map,'<%= shop.name %>');
    }
    <% end %>
  }

  // Adds a marker to the map.
  function addMarker(location, map, name) {
    // Add the marker at the clicked location, and add the next-available label
    // from the array of alphabetical characters.
    var marker = new google.maps.Marker({
      position: location,
      title: name,
      map: map
    });
  }

  //google.maps.event.addDomListener(window, 'load', initialize);
</script>
</body>
